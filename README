# 🧾 AuthorizationGateway

### Lightweight EMV Authorization Gateway — .NET 8 Web API

---

## 📘 Overview
This project simulates a lightweight payment authorization gateway that ingests EMV-like transactions, validates integrity, and applies secure data handling practices around sensitive financial information.

It was developed as part of a backend technical assessment and focuses on **architecture**, **security**, and **code clarity**.

---

## 🧭 Documentation
Full documentation is available in the **[📚 Project Wiki](../../wiki)**.

The wiki includes:
- **EMV & TLV Explanation**  
- **Architecture Overview**  
- **Security Model**  
- **API Reference & Examples**  
- **Testing Strategy**  
- **Developer Setup (Containers & Local Run)**  

> Visit the [Wiki Home](../../wiki) to explore all sections.

---

## 🐳 Quick Start (Containers)
To build and run using Docker:

```bash
docker build -t emv-gateway-api .
docker run -d -p 8080:8080 --name emv-gateway emv-gateway-api
```


----README.md
# AuthorizationGateway

Short checklist and instructions to run the project, tests and coverage.

## Run locally
- Requires .NET 8 SDK.
- Build:
  - `dotnet build`
- Run API:
  - `dotnet run --project src/AuthorizationGateway.Api/`

## Tests and coverage
- Run all tests:
  - `dotnet test`
- Run tests and collect coverage (coverlet collector is included in test projects):
  - `dotnet test --collect:"XPlat Code Coverage"`
- Produce human-readable report (install ReportGenerator if needed):
  - `dotnet tool install -g dotnet-reportgenerator-globaltool`
  - `reportgenerator -reports:"**/coverage.cobertura.xml" -targetdir:"coverage-report" -reporttypes:HtmlSummary,TextSummary`
- Open `coverage-report/index.htm` to inspect coverage. `coverage-report/Summary.txt` contains the overall percentage.

## Design choices & notes
- Transaction ID: GUID generated by `TransactionResult.TransactionId`.
- Sensitive fields (PAN `5A`, Track2 `57`) are masked before being returned or stored. Masking preserves first 4 and last 4 characters and replaces the middle with 8 asterisks. This is demonstrated in unit tests.
- Integrity protection: HMAC-SHA256 (service: `HmacIntegrityService`) is used to validate payload integrity (signature verification).
- Encryption: AES-CBC with PKCS7 in `AesEncryptionService` (demo). For production, use authenticated encryption (AES-GCM) and per-message IV handling.
- Persistence: In-memory cache (`InMemoryTransactionRepository`) used for demo only. In production swap for a durable store and never store raw PAN/Track2.
- Key handling: sample uses constructor-injected keys. In production store secrets in a secure vault (Azure Key Vault, AWS KMS) and rotate periodically.

## Tests added
- Core: TLV parser, SensitiveDataMasker, TransactionService behavior (including masking before save and tag variants).
- Infra: HMAC and AES tests, in-memory repository tests.
- Api: Controller flows (plaintext & encrypted payloads) covered.

## Security considerations
- Do not log raw PAN/Track2 — logger calls in code avoid printing sensitive values.
- In production use authenticated encryption (AEAD) and HSM / secure key storage.
- Short threat model in the `docs/THREAT_MODEL.md` (recommended) describing possible tampering, key theft, and mitigations.

# AuthorizationGateway
### Lightweight EMV Authorization Gateway — .NET 8 Web API

## Overview
This project simulates a lightweight payment authorization gateway that ingests EMV-like transactions, validates integrity, and applies secure data handling practices around sensitive financial information.


Short checklist and instructions to run the project and tests.

## Run locally
### Prerequisites
- Requires .NET 8 SDK.

### Steps
- Build:
  - `dotnet build`
- Run API:
  - `dotnet run --project src/AuthorizationGateway.Api/`

## Run in containers
### Prerequisites
- Requires Docker.

### Steps
- Build:
  - `docker build -t emv-gateway-api .`
- Run API:
  - `docker run -d -p 8080:8080 --name emv-gateway emv-gateway-api`

## Tests
- Run all tests:
  - `dotnet test`

## Design choices & notes
- Transaction ID: GUID generated by `TransactionResult.TransactionId`.


- Sensitive fields (PAN `5A`, Track2 `57`) are masked before being returned or stored. Masking preserves first 4 and last 4 characters and replaces the middle with 8 asterisks. This is demonstrated in unit tests.


- Integrity protection: HMAC-SHA256 (service: `HmacIntegrityService`) is used to validate payload integrity (signature verification).


- Encryption: AES-CBC with PKCS7 in `AesEncryptionService`.


- Persistence: In-memory cache (`InMemoryTransactionRepository`).


- Key handling: uses constructor-injected keys storage in the `appsettings.json` file. In production store secrets should be in a secure vault (Azure Key Vault, AWS KMS) and rotate periodically.

## Tests added
- Core: TLV parser, SensitiveDataMasker, TransactionService behavior (including masking before save and tag variants).


- Infra: HMAC and AES tests, in-memory repository tests.


- Api: Controller flows (plaintext & encrypted payloads) covered.

## Security considerations
- Do not log raw PAN/Track2 — logger calls in code avoid printing sensitive values.

- In production use authenticated encryption (AEAD) and HSM / secure key storage.

## Documentation
Full documentation is available in the **[Project Wiki](../../wiki)**.

The wiki includes:
- **EMV & TLV Explanation**  
- **Architecture Overview**  
- **Security Model**  
- **API Reference & Examples**  
- **Testing Strategy**  
- **Developer Setup (Containers & Local Run)**  

> Visit the [Wiki Home](../../wiki) to explore all sections.